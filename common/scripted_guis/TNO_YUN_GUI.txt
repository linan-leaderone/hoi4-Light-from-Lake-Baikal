scripted_gui = {

	TNO_YUN_NPA_Crusade_GUI = {
		context_type = decision_category
		window_name = "TNO_YUN_NPA_Crusade_GUI"
		dirty = YUN_NPA_Crusade_dirty
		visible = {
			tag = YUN
		}

		effects = {
			YUN_WI_Warlord_GUI_XIK_button_click = {
				set_variable = { YUN.YUN_WI_Warlord = 1 }
				set_variable = { YUN_WI_warlord_highlight_x = 97 }
				set_variable = { YUN_WI_warlord_highlight_y = 97 }
				add_to_variable = { YUN_NPA_Crusade_dirty = 1 }
				set_country_flag = {
					flag = YUN_button_clicked
					value = 1
					days = 1
				}
			}
			YUN_WI_Warlord_GUI_GUX_button_click = {
				set_variable = { YUN.YUN_WI_Warlord = 2 }
				set_variable = { YUN_WI_warlord_highlight_x = 217 }
				set_variable = { YUN_WI_warlord_highlight_y = 97 }
				add_to_variable = { YUN_NPA_Crusade_dirty = 1 }
				set_country_flag = {
					flag = YUN_button_clicked
					value = 1
					days = 1
				}
			}
			YUN_WI_Warlord_GUI_SHX_button_click = {
				set_variable = { YUN.YUN_WI_Warlord = 3 }
				set_variable = { YUN_WI_warlord_highlight_x = 337 }
				set_variable = { YUN_WI_warlord_highlight_y = 97 }
				add_to_variable = { YUN_NPA_Crusade_dirty = 1 }
				set_country_flag = {
					flag = YUN_button_clicked
					value = 1
					days = 1
				}
			}
			YUN_WI_Warlord_GUI_QIN_button_click = {
				set_variable = { YUN.YUN_WI_Warlord = 4 }
				set_variable = { YUN_WI_warlord_highlight_x = 97 }
				set_variable = { YUN_WI_warlord_highlight_y = 177 }
				add_to_variable = { YUN_NPA_Crusade_dirty = 1 }
				set_country_flag = {
					flag = YUN_button_clicked
					value = 1
					days = 1
				}
			}
			YUN_WI_Warlord_GUI_XIN_button_click = {
				set_variable = { YUN.YUN_WI_Warlord = 5 }
				set_variable = { YUN_WI_warlord_highlight_x = 217 }
				set_variable = { YUN_WI_warlord_highlight_y = 177 }
				add_to_variable = { YUN_NPA_Crusade_dirty = 1 }
				set_country_flag = {
					flag = YUN_button_clicked
					value = 1
					days = 1
				}
			}
			YUN_WI_Warlord_GUI_TIB_button_click = {
				set_variable = { YUN.YUN_WI_Warlord = 6 }
				set_variable = { YUN_WI_warlord_highlight_x = 337 }
				set_variable = { YUN_WI_warlord_highlight_y = 177 }
				add_to_variable = { YUN_NPA_Crusade_dirty = 1 }
				set_country_flag = {
					flag = YUN_button_clicked
					value = 1
					days = 1
				}
			}
			YUN_WI_map_entry_click = {
				if = {
					limit = { NOT = { has_country_flag = WI_GUI_map_open } }
					set_country_flag = WI_GUI_map_open
				}
				else_if = {
					limit = { has_country_flag = WI_GUI_map_open }
					clr_country_flag = WI_GUI_map_open
					clear_variable = WI_map_start_action
				}
				greater_china_states_control_change = yes
			}
			YUN_WI_map_entry_2_click = {
				if = {
					limit = { NOT = { has_country_flag = WI_GUI_map_open } }
					set_country_flag = WI_GUI_map_open
				}
				else_if = {
					limit = { has_country_flag = WI_GUI_map_open }
					clr_country_flag = WI_GUI_map_open
					clear_variable = WI_map_start_action
				}
				greater_china_states_control_change = yes
			}
		}
		triggers = {
			YUN_WI_map_entry_visible = {
				has_global_flag = WI_RGOC_takes_Sichuan
			}
			YUN_WI_map_entry_2_visible = {
				has_global_flag = WI_NPA_takes_Sichuan
			}
			YUN_WI_Crusade_GUI_warlord_highlight_visible = {
				check_variable = { YUN.YUN_WI_Warlord > 0 }
			}
		}
		properties = {
			YUN_WI_momentum_bar = {
				frame = global.YUN_WI_war_momentum_check
			}
			YUN_WI_legitimacy_bar = {
				frame = YUN_legitimacy
			}
			YUN_WI_warbuff_bar = {
				frame = YUN_WI_warbuff
			}
			YUN_WI_Crusade_GUI_warlord_highlight = {
				x = YUN_WI_warlord_highlight_x
				y = YUN_WI_warlord_highlight_y
			}
		}

		ai_enabled = { original_tag = YUN }
		ai_test_interval = 24
		ai_weights = {
			YUN_WI_Warlord_GUI_XIK_button_click = {
				ai_will_do = {
					base = 0
					modifier = {
						add = 100
						check_variable = { global.YUN_WI_war_momentum_check > 60 }
					}
				}
			}
			YUN_WI_Warlord_GUI_GUX_button_click = {
				ai_will_do = {
					base = 0
					modifier = {
						add = 100
						check_variable = { global.YUN_WI_war_momentum_check > 70 }
					}
				}
			}
			YUN_WI_Warlord_GUI_SHX_button_click = {
				ai_will_do = {
					base = 0
					modifier = {
						add = 100
						check_variable = { global.YUN_WI_war_momentum_check > 80 }
					}
				}
			}
			YUN_WI_Warlord_GUI_QIN_button_click = {
				ai_will_do = {
					base = 0
					modifier = {
						add = 100
						check_variable = { global.YUN_WI_war_momentum_check > 90 }
					}
				}
			}
			YUN_WI_Warlord_GUI_XIN_button_click = {
				ai_will_do = {
					base = 0
					modifier = {
						add = 100
						check_variable = { global.YUN_WI_war_momentum_check > 100 }
					}
				}
			}
			YUN_WI_Warlord_GUI_TIB_button_click = {
				ai_will_do = {
					base = 0
					modifier = {
						add = 100
						check_variable = { YUN_WI_Warlord = 5 }
						OR = {
							has_global_flag = XIK_joins_NPA
							has_full_control_of_state = 964
						}
						NOT = { has_country_flag = YUN_TIB_contacted }
					}
				}
			}
		}
	}

	TNO_YUN_WI_map = {
		context_type = player_context
		parent_window_token = "TNO_YUN_NPA_Crusade_GUI"
		window_name = "TNO_YUN_WI_map"
		dirty = YUN.YUN_WI_dirty

		visible = {
			has_country_flag = WI_GUI_map_open
		}

		dynamic_lists = {
			WI_show_country_map = {
				array = YUN.greater_china_states_map
				index = WI_states_i
				value = WI_state_id
				change_scope = yes
				entry_container = WI_china_states_control
			}
			WI_xinan_map = {
				array = YUN.china_region_xinan_map
				entry_container = WI_GUI_xinan_map
				index = china_region_xinan_map_i
				value = WI_state_id
				change_scope = yes
			}
			WI_huazhong_map = {
				array = YUN.china_region_huazhong_map
				entry_container = WI_GUI_huazhong_map
				index = china_region_huazhong_map_i
				value = WI_state_id
				change_scope = yes
			}
			WI_huadong_map = {
				array = YUN.china_region_huadong_map
				entry_container = WI_GUI_huadong_map
				index = china_region_huadong_map_i
				value = WI_state_id
				change_scope = yes
			}
			WI_huanan_map = {
				array = YUN.china_region_huanan_map
				entry_container = WI_GUI_huanan_map
				index = china_region_huanan_map_i
				value = WI_state_id
				change_scope = yes
			}
			WI_huabei_map = {
				array = YUN.china_region_huabei_map
				entry_container = WI_GUI_huabei_map
				index = china_region_huabei_map_i
				value = WI_state_id
				change_scope = yes
			}
			WI_xibei_map = {
				array = YUN.china_region_xibei_map
				entry_container = WI_GUI_xibei_map
				index = china_region_xibei_map_i
				value = WI_state_id
				change_scope = yes
			}
			WI_dongbei_map = {
				array = YUN.china_region_dongbei_map
				entry_container = WI_GUI_dongbei_map
				index = china_region_dongbei_map_i
				value = WI_state_id
				change_scope = yes
			}

			WI_greater_china_region_xinan = {
				array = YUN.china_region_xinan
				entry_container = WI_china_region_xinan
				index = china_region_xinan_i
				value = WI_state_id
			}
			WI_greater_china_region_huazhong = {
				array = YUN.china_region_huazhong
				entry_container = WI_china_region_huazhong
				index = china_region_huazhong_i
				value = WI_state_id
			}
			WI_greater_china_region_huadong = {
				array = YUN.china_region_huadong
				entry_container = WI_china_region_huadong
				index = china_region_huadong_i
				value = WI_state_id
			}
			WI_greater_china_region_huanan = {
				array = YUN.china_region_huanan
				entry_container = WI_china_region_huanan
				index = china_region_huanan_i
				value = WI_state_id
			}
			WI_greater_china_region_huabei = {
				array = YUN.china_region_huabei
				entry_container = WI_china_region_huabei
				index = china_region_huabei_i
				value = WI_state_id
			}
			WI_greater_china_region_xibei = {
				array = YUN.china_region_xibei
				entry_container = WI_china_region_xibei
				index = china_region_xibei_i
				value = WI_state_id
			}
			WI_greater_china_region_dongbei = {
				array = YUN.china_region_dongbei
				entry_container = WI_china_region_dongbei
				index = china_region_dongbei_i
				value = WI_state_id
			}

			WI_greater_china_states_action_GUI = {
				array = YUN.china_states_action
				entry_container = WI_china_states_action_GUI
				value = china_states_action_id
			}
		}

		effects = {
			YUN_WI_close_button_click = {
				clr_country_flag = WI_GUI_map_open
				clear_variable = WI_map_start_action
			}
			WI_map_state_control_click = {
				set_variable = { WI_map_section = 1 }
				greater_china_states_control_change = yes
			}
			WI_map_state_supply_click = {
				set_variable = { WI_map_section = 2 }
				#YUN_update_state_officers_effects = yes
				update_YUN_WI_map = yes
			}
			WI_map_state_country_section_click = {
				set_variable = { WI_map_level = 1 }
				WI_show_whole_map = yes
				update_YUN_WI_map = yes
			}
			WI_map_state_region_section_click = {
				set_variable = { WI_map_level = 2 }
				WI_show_region_map = yes
				update_YUN_WI_map = yes
			}
			WI_map_china_regions_xinan_click = {
				set_variable = { WI_open_region = 1 }
				set_variable = { WI_check_region = 1 }
				if = {
					limit = { check_variable = { WI_map_level = 2 } }
					WI_show_region_map = yes
				}
				set_variable = { YUN_WI_region_highlight_x = 330 }
				set_variable = { YUN_WI_region_highlight_y = 20 }
				update_YUN_WI_map = yes
			}
			WI_map_china_regions_huazhong_click = {
				set_variable = { WI_open_region = 2 }
				set_variable = { WI_check_region = 2 }
				if = {
					limit = { check_variable = { WI_map_level = 2 } }
					WI_show_region_map = yes
				}
				set_variable = { YUN_WI_region_highlight_x = 280 }
				set_variable = { YUN_WI_region_highlight_y = 20 }
				update_YUN_WI_map = yes
			}
			WI_map_china_regions_huadong_click = {
				set_variable = { WI_open_region = 3 }
				set_variable = { WI_check_region = 3 }
				if = {
					limit = { check_variable = { WI_map_level = 2 } }
					WI_show_region_map = yes
				}
				set_variable = { YUN_WI_region_highlight_x = 230 }
				set_variable = { YUN_WI_region_highlight_y = 20 }
				update_YUN_WI_map = yes
			}
			WI_map_china_regions_huanan_click = {
				set_variable = { WI_open_region = 4 }
				set_variable = { WI_check_region = 4 }
				if = {
					limit = { check_variable = { WI_map_level = 2 } }
					WI_show_region_map = yes
				}
				set_variable = { YUN_WI_region_highlight_x = 180 }
				set_variable = { YUN_WI_region_highlight_y = 20 }
				update_YUN_WI_map = yes
			}
			WI_map_china_regions_huabei_click = {
				set_variable = { WI_open_region = 5 }
				set_variable = { WI_check_region = 5 }
				if = {
					limit = { check_variable = { WI_map_level = 2 } }
					WI_show_region_map = yes
				}
				set_variable = { YUN_WI_region_highlight_x = 130 }
				set_variable = { YUN_WI_region_highlight_y = 20 }
				update_YUN_WI_map = yes
			}
			WI_map_china_regions_xibei_click = {
				set_variable = { WI_open_region = 6 }
				set_variable = { WI_check_region = 6 }
				if = {
					limit = { check_variable = { WI_map_level = 2 } }
					WI_show_region_map = yes
				}
				set_variable = { YUN_WI_region_highlight_x = 80 }
				set_variable = { YUN_WI_region_highlight_y = 20 }
				update_YUN_WI_map = yes
			}
			WI_map_china_regions_dongbei_click = {
				set_variable = { WI_open_region = 7 }
				set_variable = { WI_check_region = 7 }
				if = {
					limit = { check_variable = { WI_map_level = 2 } }
					WI_show_region_map = yes
				}
				set_variable = { YUN_WI_region_highlight_x = 30 }
				set_variable = { YUN_WI_region_highlight_y = 20 }
				update_YUN_WI_map = yes
			}
			WI_map_xinan_click = {
				set_variable = { china_acted_state = WI_state_id }
				set_variable = { china_acted_region = 1 }
				if = {
					limit = { NOT = { has_country_flag = WI_map_first_time } }
					greater_china_states_control_change = yes
					set_country_flag = WI_map_first_time
				}
				update_YUN_WI_map = yes
			}
			WI_map_huazhong_click = {
				set_variable = { china_acted_state = WI_state_id }
				set_variable = { china_acted_region = 2 }
				if = {
					limit = { NOT = { has_country_flag = WI_map_first_time } }
					greater_china_states_control_change = yes
					set_country_flag = WI_map_first_time
				}
				update_YUN_WI_map = yes
			}
			WI_map_huadong_click = {
				set_variable = { china_acted_state = WI_state_id }
				set_variable = { china_acted_region = 3 }
				if = {
					limit = { NOT = { has_country_flag = WI_map_first_time } }
					greater_china_states_control_change = yes
					set_country_flag = WI_map_first_time
				}
				update_YUN_WI_map = yes
			}
			WI_map_huanan_click = {
				set_variable = { china_acted_state = WI_state_id }
				set_variable = { china_acted_region = 4 }
				if = {
					limit = { NOT = { has_country_flag = WI_map_first_time } }
					greater_china_states_control_change = yes
					set_country_flag = WI_map_first_time
				}
				update_YUN_WI_map = yes
			}
			WI_map_huabei_click = {
				set_variable = { china_acted_state = WI_state_id }
				set_variable = { china_acted_region = 5 }
				if = {
					limit = { NOT = { has_country_flag = WI_map_first_time } }
					greater_china_states_control_change = yes
					set_country_flag = WI_map_first_time
				}
				update_YUN_WI_map = yes
			}
			WI_map_xibei_click = {
				set_variable = { china_acted_state = WI_state_id }
				set_variable = { china_acted_region = 6 }
				if = {
					limit = { NOT = { has_country_flag = WI_map_first_time } }
					greater_china_states_control_change = yes
					set_country_flag = WI_map_first_time
				}
				update_YUN_WI_map = yes
			}
			WI_map_dongbei_click = {
				set_variable = { china_acted_state = WI_state_id }
				set_variable = { china_acted_region = 7 }
				if = {
					limit = { NOT = { has_country_flag = WI_map_first_time } }
					greater_china_states_control_change = yes
					set_country_flag = WI_map_first_time
				}
				update_YUN_WI_map = yes
			}
			WI_map_change_logunit_click = {
				clear_variable = YUN_WI_logunit_percent_change
				set_temp_variable = { YUN_WI_old_logunit_calc = YUN_WI_max_logunit }
				multiply_temp_variable = { YUN_WI_old_logunit_calc = YUN_WI_logunit_percent_confirmed }
				divide_temp_variable = { YUN_WI_old_logunit_calc = 10 }

				set_variable = { YUN_WI_logunit_confirmed = YUN_WI_logunit_percent }
				set_variable = { YUN_WI_logunit_percent_confirmed = YUN_WI_logunit_percent }
				multiply_variable = { YUN_WI_logunit_confirmed = YUN_WI_max_logunit }
				divide_variable = { YUN_WI_logunit_confirmed = 10 }
				subtract_from_variable = { YUN_WI_logunit_confirmed = YUN_WI_old_logunit_calc }
				add_to_variable = { YUN_WI_logunit = YUN_WI_logunit_confirmed }
				set_country_flag = {
					flag = WI_map_change_logunit_cooldown
					days = 30
					value = 1
				}
				add_political_power = -20
				YUN_WI_officer_spend_calc = yes
				clear_variable = YUN_WI_admin_min_spend
				clear_variable = YUN_WI_admin_max_spend
				clear_variable = YUN_WI_mil_min_spend
				clear_variable = YUN_WI_mil_max_spend
				update_YUN_WI_map = yes
			}

			WI_map_increase_logunit_percent_click = {
				add_to_variable = { YUN_WI_logunit_percent = 1 }
				clamp_variable = {
					var = YUN_WI_logunit_percent
					min = 1
					max = 10
				}
				set_variable = { YUN_WI_estimated_officers = YUN_WI_max_logunit }
				multiply_variable = { YUN_WI_estimated_officers = YUN_WI_logunit_percent }
				divide_variable = { YUN_WI_estimated_officers = 10 }
				set_variable = { YUN_WI_logunit_percent_change = YUN_WI_logunit_percent }
				subtract_from_variable = { YUN_WI_logunit_percent_change = YUN_WI_logunit_percent_confirmed }
				if = {
					limit = { check_variable = { YUN_WI_logunit_percent = 2 } }
					add_to_variable = { YUN_WI_mil_min_spend = -5 }
					add_to_variable = { YUN_WI_mil_max_spend = -5 }
				}
				if = {
					limit = { check_variable = { YUN_WI_logunit_percent > 5 } }
					add_to_variable = { YUN_WI_admin_min_spend = 10 }
					add_to_variable = { YUN_WI_admin_max_spend = 5 }
					add_to_variable = { YUN_WI_mil_min_spend = -5 }
					add_to_variable = { YUN_WI_mil_max_spend = -10 }
				}
				else_if = {
					limit = {
						check_variable = {
							var = YUN_WI_logunit_percent
							value = 5
							compare = less_than_or_equals
						}
					}
					add_to_variable = { YUN_WI_admin_min_spend = 5 }
					add_to_variable = { YUN_WI_admin_max_spend = 10 }
					add_to_variable = { YUN_WI_mil_min_spend = -10 }
					add_to_variable = { YUN_WI_mil_max_spend = -5 }
				}
				update_YUN_WI_map = yes
			}
			WI_map_decrease_logunit_percent_click = {
				add_to_variable = { YUN_WI_logunit_percent = -1 }
				clamp_variable = {
					var = YUN_WI_logunit_percent
					min = 1
					max = 10
				}
				set_variable = { YUN_WI_estimated_officers = YUN_WI_max_logunit }
				multiply_variable = { YUN_WI_estimated_officers = YUN_WI_logunit_percent }
				divide_variable = { YUN_WI_estimated_officers = 10 }
				set_variable = { YUN_WI_logunit_percent_change = YUN_WI_logunit_percent }
				subtract_from_variable = { YUN_WI_logunit_percent_change = YUN_WI_logunit_percent_confirmed }
				if = {
					limit = { check_variable = { YUN_WI_logunit_percent < 5 } }
					add_to_variable = { YUN_WI_admin_min_spend = -5 }
					add_to_variable = { YUN_WI_admin_max_spend = -10 }
					add_to_variable = { YUN_WI_mil_min_spend = 10 }
					add_to_variable = { YUN_WI_mil_max_spend = 5 }
				}
				else_if = {
					limit = {
						check_variable = {
							var = YUN_WI_logunit_percent
							value = 5
							compare = greater_than_or_equals
						}
					}
					add_to_variable = { YUN_WI_admin_min_spend = -10 }
					add_to_variable = { YUN_WI_admin_max_spend = -5 }
					add_to_variable = { YUN_WI_mil_min_spend = 5 }
					add_to_variable = { YUN_WI_mil_max_spend = 10 }
				}
				if = {
					limit = { check_variable = { YUN_WI_logunit_percent = 1 } }
					add_to_variable = { YUN_WI_mil_min_spend = 5 }
					add_to_variable = { YUN_WI_mil_max_spend = 5 }
				}
				update_YUN_WI_map = yes
			}
			WI_country_map_click = {
				YUN = {
					set_variable = { china_acted_state = PREV }
					if = {
						limit = {
							check_variable = { WI_states_i < 12 }
						}
						set_variable = { WI_open_region = 1 }
						set_variable = { WI_check_region = 1 }
						set_variable = { china_acted_region = 1 }
						if = {
							limit = { check_variable = { WI_map_level = 2 } }
							WI_show_region_map = yes
						}
						set_variable = { YUN_WI_region_highlight_x = 330 }
						set_variable = { YUN_WI_region_highlight_y = 20 }
					}
					else_if = {
						limit = {
							check_variable = { WI_states_i < 21 }
						}
						set_variable = { WI_open_region = 2 }
						set_variable = { WI_check_region = 2 }
						set_variable = { china_acted_region = 2 }
						if = {
							limit = { check_variable = { WI_map_level = 2 } }
							WI_show_region_map = yes
						}
						set_variable = { YUN_WI_region_highlight_x = 280 }
						set_variable = { YUN_WI_region_highlight_y = 20 }
					}
					else_if = {
						limit = {
							check_variable = { WI_states_i < 35 }
						}
						set_variable = { WI_open_region = 3 }
						set_variable = { WI_check_region = 3 }
						set_variable = { china_acted_region = 3 }
						if = {
							limit = { check_variable = { WI_map_level = 2 } }
							WI_show_region_map = yes
						}
						set_variable = { YUN_WI_region_highlight_x = 230 }
						set_variable = { YUN_WI_region_highlight_y = 20 }
					}
					else_if = {
						limit = {
							check_variable = { WI_states_i < 46 }
						}
						set_variable = { WI_open_region = 4 }
						set_variable = { WI_check_region = 4 }
						set_variable = { china_acted_region = 4 }
						if = {
							limit = { check_variable = { WI_map_level = 2 } }
							WI_show_region_map = yes
						}
						set_variable = { YUN_WI_region_highlight_x = 180 }
						set_variable = { YUN_WI_region_highlight_y = 20 }
					}
					else_if = {
						limit = {
							check_variable = { WI_states_i < 58 }
						}
						set_variable = { WI_open_region = 5 }
						set_variable = { WI_check_region = 5 }
						set_variable = { china_acted_region = 5 }
						if = {
							limit = { check_variable = { WI_map_level = 2 } }
							WI_show_region_map = yes
						}
						set_variable = { YUN_WI_region_highlight_x = 130 }
						set_variable = { YUN_WI_region_highlight_y = 20 }
					}
					else_if = {
						limit = {
							check_variable = { WI_states_i < 71 }
						}
						set_variable = { WI_open_region = 6 }
						set_variable = { WI_check_region = 6 }
						set_variable = { china_acted_region = 6 }
						if = {
							limit = { check_variable = { WI_map_level = 2 } }
							WI_show_region_map = yes
						}
						set_variable = { YUN_WI_region_highlight_x = 80 }
						set_variable = { YUN_WI_region_highlight_y = 20 }
					}
					else_if = {
						limit = {
							check_variable = { WI_states_i < 85 }
						}
						set_variable = { WI_open_region = 7 }
						set_variable = { WI_check_region = 7 }
						set_variable = { china_acted_region = 7 }
						if = {
							limit = { check_variable = { WI_map_level = 2 } }
							WI_show_region_map = yes
						}
						set_variable = { YUN_WI_region_highlight_x = 30 }
						set_variable = { YUN_WI_region_highlight_y = 20 }
					}

					if = {
						limit = { NOT = { has_country_flag = WI_map_first_time } }
						greater_china_states_control_change = yes
						set_country_flag = WI_map_first_time
					}
					update_YUN_WI_map = yes
				}
			}
			WI_map_xinan_states_click = {
				YUN = {
					set_variable = { china_acted_state = PREV }
					set_variable = { WI_open_region = 1 }
					set_variable = { WI_check_region = 1 }
					set_variable = { china_acted_region = 1 }
					set_variable = { YUN_WI_region_highlight_x = 330 }
					set_variable = { YUN_WI_region_highlight_y = 20 }
					update_YUN_WI_map = yes
				}
			}
			WI_map_huazhong_states_click = {
				YUN = {
					set_variable = { china_acted_state = PREV }
					set_variable = { WI_open_region = 2 }
					set_variable = { WI_check_region = 2 }
					set_variable = { china_acted_region = 2 }
					set_variable = { YUN_WI_region_highlight_x = 280 }
					set_variable = { YUN_WI_region_highlight_y = 20 }
					update_YUN_WI_map = yes
				}
			}
			WI_map_huadong_states_click = {
				YUN = {
					set_variable = { china_acted_state = PREV }
					set_variable = { WI_open_region = 3 }
					set_variable = { WI_check_region = 3 }
					set_variable = { china_acted_region = 3 }
					set_variable = { YUN_WI_region_highlight_x = 230 }
					set_variable = { YUN_WI_region_highlight_y = 20 }
					update_YUN_WI_map = yes
				}
			}
			WI_map_huanan_states_click = {
				YUN = {
					set_variable = { china_acted_state = PREV }
					set_variable = { WI_open_region = 4 }
					set_variable = { WI_check_region = 4 }
					set_variable = { china_acted_region = 4 }
					set_variable = { YUN_WI_region_highlight_x = 180 }
					set_variable = { YUN_WI_region_highlight_y = 20 }
					update_YUN_WI_map = yes
				}
			}
			WI_map_huabei_states_click = {
				YUN = {
					set_variable = { china_acted_state = PREV }
					set_variable = { WI_open_region = 5 }
					set_variable = { WI_check_region = 5 }
					set_variable = { china_acted_region = 5 }
					set_variable = { YUN_WI_region_highlight_x = 130 }
					set_variable = { YUN_WI_region_highlight_y = 20 }
					update_YUN_WI_map = yes
				}
			}
			WI_map_xibei_states_click = {
				YUN = {
					set_variable = { china_acted_state = PREV }
					set_variable = { WI_open_region = 6 }
					set_variable = { WI_check_region = 6 }
					set_variable = { china_acted_region = 6 }
					set_variable = { YUN_WI_region_highlight_x = 80 }
					set_variable = { YUN_WI_region_highlight_y = 20 }
					update_YUN_WI_map = yes
				}
			}
			WI_map_dongbei_states_click = {
				YUN = {
					set_variable = { china_acted_state = PREV }
					set_variable = { WI_open_region = 7 }
					set_variable = { WI_check_region = 7 }
					set_variable = { china_acted_region = 7 }
					set_variable = { YUN_WI_region_highlight_x = 30 }
					set_variable = { YUN_WI_region_highlight_y = 20 }
					update_YUN_WI_map = yes
				}
			}
			YUN_WI_map_admin_button_2_click = {
				set_variable = { WI_map_state_section_GUI = 1 }
			}
			YUN_WI_map_mil_button_2_click = {
				set_variable = { WI_map_state_section_GUI = 2 }
			}
			WI_map_china_states_action_GUI_click = {
				YUN_WI_china_states_action_GUI_starts = yes
			}
			WI_map_strategy_attack_GUI_click = {
				var:china_acted_state = {
					set_variable = { WI_map_strategy = 1 }
					YUN_province_mil_strategy_attack_calc = yes
				}
				custom_effect_tooltip = YUN_province_mil_strategy_GUI_attack_tt
			}
			WI_map_strategy_defense_GUI_click = {
				var:china_acted_state = {
					set_variable = { WI_map_strategy = 2 }
					YUN_province_mil_strategy_defense_calc = yes
				}
				custom_effect_tooltip = YUN_province_mil_strategy_GUI_defense_tt
			}
		}

		triggers = {
			gui_alert_visible = {
				has_country_flag = gui_alert_visible
			}
			WI_map_xinan_visible = {
				check_variable = { WI_open_region = 1 }
			}
			WI_map_huazhong_visible = {
				check_variable = { WI_open_region = 2 }
			}
			WI_map_huadong_visible = {
				check_variable = { WI_open_region = 3 }
			}
			WI_map_huanan_visible = {
				check_variable = { WI_open_region = 4 }
			}
			WI_map_huabei_visible = {
				check_variable = { WI_open_region = 5 }
			}
			WI_map_xibei_visible = {
				check_variable = { WI_open_region = 6 }
			}
			WI_map_dongbei_visible = {
				check_variable = { WI_open_region = 7 }
			}
			WI_map_state_integration_info_visible = {
				var:china_acted_state = {
					is_controlled_by = YUN
					NOT = { state = 325 }
					NOT = { state = 960 }
					NOT = { state = 603 }
					if = {
						limit = { has_global_flag = WI_NPA_takes_Sichuan }
						NOT = { state = 605 }
						NOT = { state = 1537 }
						NOT = { state = 1538 }
					}
				}
			}
			WI_map_state_administration_info_visible = {
				var:china_acted_state = {
					is_controlled_by = YUN
					NOT = { state = 325 }
					NOT = { state = 960 }
					NOT = { state = 603 }
					if = {
						limit = { has_global_flag = WI_NPA_takes_Sichuan }
						NOT = { state = 605 }
						NOT = { state = 1537 }
						NOT = { state = 1538 }
					}
				}
			}
			WI_map_state_militarization_info_visible = {
				var:china_acted_state = {
					is_controlled_by = YUN
				}
			}
			YUN_WI_map_admin_button_2_click_enabled = {
				has_variable = china_acted_state
				var:china_acted_state = {
					is_controlled_by = YUN
					NOT = { state = 325 }
					NOT = { state = 960 }
					NOT = { state = 603 }
					if = {
						limit = { has_global_flag = WI_NPA_takes_Sichuan }
						NOT = { state = 605 }
						NOT = { state = 1537 }
						NOT = { state = 1538 }
					}
				}
			}
			YUN_WI_map_mil_button_2_click_enabled = {
				has_variable = china_acted_state
				var:china_acted_state = {
					is_controlled_by = YUN
				}
			}
			WI_map_change_logunit_click_enabled = {
				has_political_power > 20
				custom_trigger_tooltip = {
					tooltip = WI_map_change_logunit_click_enabled_tt
					check_variable = { YUN_WI_estimated_officers > WI_officers_taken_total }
					NOT = { check_variable = { YUN_WI_logunit_confirmed = YUN_WI_logunit_percent } }
				}
				#custom_trigger_tooltip = {
				#	tooltip = WI_map_change_logunit_click_enabled_tt_2
				#	NOT = { has_country_flag = WI_map_change_logunit_cooldown }
				#}
				NOT = { check_variable = { YUN_WI_logunit_percent_confirmed = YUN_WI_logunit_percent } }
			}
			WI_map_increase_logunit_percent_click_enabled = {
				check_variable = { YUN_WI_logunit_percent < 10 }
			}
			WI_map_decrease_logunit_percent_click_enabled = {
				check_variable = { YUN_WI_logunit_percent > 1 }
				NOT = {
					check_variable = { YUN_WI_logunit < 0 }
				}
			}
			WI_map_region_highlight_visible = {
				check_variable = { WI_open_region > 0 }
			}
			WI_map_complete_map_visible = {
				check_variable = { WI_map_level = 1 }
			}
			WI_map_xinan_map_visible = {
				check_variable = { WI_map_level = 2 }
				check_variable = { WI_open_region = 1 }
			}
			WI_map_huazhong_map_visible = {
				check_variable = { WI_map_level = 2 }
				check_variable = { WI_open_region = 2 }
			}
			WI_map_huadong_map_visible = {
				check_variable = { WI_map_level = 2 }
				check_variable = { WI_open_region = 3 }
			}
			WI_map_huanan_map_visible = {
				check_variable = { WI_map_level = 2 }
				check_variable = { WI_open_region = 4 }
			}
			WI_map_huabei_map_visible = {
				check_variable = { WI_map_level = 2 }
				check_variable = { WI_open_region = 5 }
			}
			WI_map_xibei_map_visible = {
				check_variable = { WI_map_level = 2 }
				check_variable = { WI_open_region = 6 }
			}
			WI_map_dongbei_map_visible = {
				check_variable = { WI_map_level = 2 }
				check_variable = { WI_open_region = 7 }
			}
			WI_map_china_states_action_GUI_visible = {
				var:china_acted_state = { is_controlled_by = YUN }
			}
			WI_map_strategy_attack_GUI_visible = {
				var:china_acted_state = { is_controlled_by = YUN }
			}
			WI_map_strategy_defense_GUI_visible = {
				var:china_acted_state = { is_controlled_by = YUN }
			}
			WI_map_china_states_action_GUI_click_enabled = {
				YUN_WI_map_enable_action_GUI = yes
			}
			WI_map_strategy_attack_GUI_click_enabled = {
				custom_trigger_tooltip = {
					tooltip = WI_map_strategy_GUI_click_enabled_tt
					var:china_acted_state = {
						NOT = { check_variable = { WI_map_strategy > 0 } }
					}
				}
			}
			WI_map_strategy_defense_GUI_click_enabled = {
				custom_trigger_tooltip = {
					tooltip = WI_map_strategy_GUI_click_enabled_tt
					var:china_acted_state = {
						NOT = { check_variable = { WI_map_strategy > 0 } }
					}
				}
			}
		}

		properties = {
			WI_country_map = {
				frame = greater_china_states_i
				image = [GetWI_greater_china_states_show]
				x = greater_china_states_X
				y = greater_china_states_Y
			}
			WI_map_city_pic = {
				image = [GetWI_map_city_pic]
			}
			WI_selected_state_checkbox_1 = {
				frame = YUN_WI_checkbox_1
			}
			WI_selected_state_checkbox_2 = {
				frame = YUN_WI_checkbox_2
			}
			WI_selected_state_checkbox_3 = {
				frame = YUN_WI_checkbox_3
			}
			WI_map_xinan_states = {
				frame = greater_china_states_i
				image = [GetWI_map_xinan]
				x = greater_china_states_X
				y = greater_china_states_Y
			}
			WI_map_huazhong_states = {
				frame = greater_china_states_i
				image = [GetWI_map_huazhong]
				x = greater_china_states_X
				y = greater_china_states_Y
			}
			WI_map_huadong_states = {
				frame = greater_china_states_i
				image = [GetWI_map_huadong]
				x = greater_china_states_X
				y = greater_china_states_Y
			}
			WI_map_huanan_states = {
				frame = greater_china_states_i
				image = [GetWI_map_huanan]
				x = greater_china_states_X
				y = greater_china_states_Y
			}
			WI_map_huabei_states = {
				frame = greater_china_states_i
				image = [GetWI_map_huabei]
				x = greater_china_states_X
				y = greater_china_states_Y
			}
			WI_map_xibei_states = {
				frame = greater_china_states_i
				image = [GetWI_map_xibei]
				x = greater_china_states_X
				y = greater_china_states_Y
			}
			WI_map_dongbei_states = {
				frame = greater_china_states_i
				image = [GetWI_map_dongbei]
				x = greater_china_states_X
				y = greater_china_states_Y
			}
			WI_map_region_highlight = {
				x = YUN_WI_region_highlight_x
				y = YUN_WI_region_highlight_y
			}
			WI_map_china_states_action_GUI = {
				image = [GetWIwarmeasures]
			}
		}
	}

	TNO_YUN_WI_state_action_section = {
		context_type = selected_state_context
		parent_window_token = selected_state_view
		window_name = "TNO_YUN_WI_state_action_section"

		visible = {
			ROOT = { original_tag = YUN }
			is_in_array = { YUN.greater_china_states = THIS }
			THIS = { controller = { original_tag = YUN } }
			YUN = {
				NOT = { has_country_flag = YUN_Long_Yun_dead_flag }
				NOT = { has_country_flag = YUN_complete_reintegration }
			}
			OR = {
				has_global_flag = CHI_Western_Insurrection_Crisis
				has_global_flag = YUN_NPA_GAW_Crisis
				has_global_flag = YUN_ROC_reborn
			}
		}

		effects = {
			WI_map_adm_action_click = {
				if = {
					limit = { NOT = { has_variable = YUN.state_admin_level_scale } }
					set_variable = { YUN.state_admin_level_scale = 1 }
				}
				YUN = { set_variable = { WI_map_state_section = 1 } }
			}
			WI_map_mil_action_click = {
				if = {
					limit = { NOT = { has_variable = YUN.state_mil_level_scale } }
					set_variable = { YUN.state_mil_level_scale = 1 }
				}
				YUN = { set_variable = { WI_map_state_section = 2 } }
			}
			WI_map_strategy_attack_click = {
				set_variable = { WI_map_strategy = 1 }
				YUN_province_mil_strategy_attack_calc = yes
				custom_effect_tooltip = YUN_province_mil_strategy_attack_tt
			}
			WI_map_strategy_defense_click = {
				set_variable = { WI_map_strategy = 2 }
				YUN_province_mil_strategy_defense_calc = yes
				custom_effect_tooltip = YUN_province_mil_strategy_defense_tt
			}
		}

		triggers = {
			WI_map_adm_action_visible = {
				THIS = {
					NOT = { state = 325 }
					NOT = { state = 603 }
					NOT = { state = 960 }
				}
				OR = {
					has_global_flag = WI_RGOC_takes_Sichuan
					AND = {
						has_global_flag = WI_NPA_takes_Sichuan
						THIS = {
							NOT = { state = 605 }
							NOT = { state = 1537 }
							NOT = { state = 1538 }
						}
					}
				}
			}
			WI_map_mil_action_visible = {
				OR = {
					has_global_flag = CHI_Western_Insurrection_Crisis
					has_global_flag = YUN_NPA_GAW_Crisis
				}
			}
			WI_map_strategy_attack_visible = {
				OR = {
					has_global_flag = CHI_Western_Insurrection_Crisis
					has_global_flag = YUN_NPA_GAW_Crisis
				}
			}
			WI_map_strategy_defense_visible = {
				OR = {
					has_global_flag = CHI_Western_Insurrection_Crisis
					has_global_flag = YUN_NPA_GAW_Crisis
				}
			}
			WI_map_strategy_attack_click_enabled = {
				custom_trigger_tooltip = {
					tooltip = WI_map_strategy_click_enabled_tt
					THIS = {
						NOT = { check_variable = { WI_map_strategy > 0 } }
					}
				}
			}
			WI_map_strategy_defense_click_enabled = {
				custom_trigger_tooltip = {
					tooltip = WI_map_strategy_click_enabled_tt
					THIS = {
						NOT = { check_variable = { WI_map_strategy > 0 } }
					}
				}
			}
		}
	}

	TNO_YUN_WI_states_action_adm_GUI = {
		context_type = player_context
		parent_window_token = "TNO_YUN_WI_map"
		window_name = "TNO_YUN_WI_states_action_adm_GUI"
#
		visible = {
			check_variable = { WI_map_state_section_GUI = 1 }
			var:china_acted_state = {
				is_controlled_by = YUN
				NOT = { state = 325 }
				NOT = { state = 603 }
				NOT = { state = 960 }
				if = {
					limit = { has_global_flag = WI_NPA_takes_Sichuan }
					NOT = { state = 605 }
					NOT = { state = 1537 }
					NOT = { state = 1538 }
				}
			}
			has_country_flag = WI_GUI_map_open
		}
#
		effects = {
			WI_action_adm_close_button_GUI_click = {
				clear_variable = WI_map_state_section_GUI
			}
			WI_map_change_state_logunit_GUI_click = {
				var:china_acted_state = {
					set_state_flag = {
						flag = WI_map_change_state_logunit_cooldown
						days = 30
						value = 1
					}
					set_variable = { WI_current_state_officer = YUN_WI_state_logunit_change_confirmed }
					clear_variable = YUN_WI_state_logunit_percent
					clear_variable = WI_officer_change_calc
					YUN_update_state_officers_effects = yes
					add_to_variable = { YUN.WI_officers_taken_total = WI_old_state_officer_confirmed }
					subtract_from_variable = { YUN.YUN_WI_logunit = WI_old_state_officer_confirmed }
				}
				add_political_power = -10
				update_YUN_WI_map = yes
			}
			WI_map_increase_state_logunit_percent_GUI_click = {
				if = {
					limit = { check_variable = { state_admin_level_scale = 2 } }
					var:china_acted_state = {
						add_to_variable = { YUN_WI_state_logunit_percent = 10 }
						WI_map_state_logunit_calc = yes
					}
				}
				else = {
					var:china_acted_state = {
						add_to_variable = { YUN_WI_state_logunit_percent = 5 }
						WI_map_state_logunit_calc = yes
					}
				}
			}
			WI_map_decrease_state_logunit_percent_GUI_click = {
				if = {
					limit = { check_variable = { state_admin_level_scale = 2 } }
					var:china_acted_state = {
						add_to_variable = { YUN_WI_state_logunit_percent = -10 }
						WI_map_state_logunit_calc = yes
					}
				}
				else = {
					var:china_acted_state = {
						add_to_variable = { YUN_WI_state_logunit_percent = -5 }
						WI_map_state_logunit_calc = yes
					}
				}
			}
			WI_map_state_admin_level_5x_GUI_click = {
				set_variable = { state_admin_level_scale = 1 }
			}
			WI_map_state_admin_level_10x_GUI_click = {
				set_variable = { state_admin_level_scale = 2 }
			}
			WI_map_state_admin_level_one_quarter_GUI_click = {
				var:china_acted_state = {
					set_temp_variable = { WI_state_25_percent_adm = YUN_state_officer_percentage }
					subtract_from_temp_variable = { WI_state_25_percent_adm = 25 }
					multiply_temp_variable = { WI_state_25_percent_adm = -1 }
					set_variable = { YUN_WI_state_logunit_percent = WI_state_25_percent_adm }
					WI_map_state_logunit_calc = yes
				}
			}
			WI_map_state_admin_level_half_GUI_click = {
				var:china_acted_state = {
					set_temp_variable = { WI_state_50_percent_adm = YUN_state_officer_percentage }
					subtract_from_temp_variable = { WI_state_50_percent_adm = 50 }
					multiply_temp_variable = { WI_state_50_percent_adm = -1 }
					set_variable = { YUN_WI_state_logunit_percent = WI_state_50_percent_adm }
					WI_map_state_logunit_calc = yes
				}
			}
			WI_map_state_admin_level_three_quarter_GUI_click = {
				var:china_acted_state = {
					set_temp_variable = { WI_state_75_percent_adm = YUN_state_officer_percentage }
					subtract_from_temp_variable = { WI_state_75_percent_adm = 75 }
					multiply_temp_variable = { WI_state_75_percent_adm = -1 }
					set_variable = { YUN_WI_state_logunit_percent = WI_state_75_percent_adm }
					WI_map_state_logunit_calc = yes
				}
			}
			WI_map_state_admin_level_full_GUI_click = {
				var:china_acted_state = {
					set_temp_variable = { WI_state_100_percent_adm = YUN_state_officer_percentage }
					subtract_from_temp_variable = { WI_state_100_percent_adm = 100 }
					multiply_temp_variable = { WI_state_100_percent_adm = -1 }
					set_variable = { YUN_WI_state_logunit_percent = WI_state_100_percent_adm }
					WI_map_state_logunit_calc = yes
				}
			}
		}
#
		triggers = {
			WI_map_increase_state_logunit_percent_GUI_click_enabled = {
				var:china_acted_state = {
					check_variable = { YUN_officier_percent_calc < 100 }
				}
			}
			WI_map_decrease_state_logunit_percent_GUI_click_enabled = {
				var:china_acted_state = {
					check_variable = { YUN_officier_percent_calc > 0 }
				}
			}
			WI_map_state_admin_level_5x_GUI_click_enabled = {
				check_variable = { state_admin_level_scale = 2 }
			}
			WI_map_state_admin_level_10x_GUI_click_enabled = {
				check_variable = { state_admin_level_scale = 1 }
			}
			WI_map_change_state_logunit_GUI_click_enabled = {
				has_political_power > 10
				custom_trigger_tooltip = {
					tooltip = WI_map_change_state_logunit_GUI_click_enabled_tt_1
					var:china_acted_state = {
						NOT = { has_state_flag = WI_map_change_state_logunit_cooldown }
					}
				}
				custom_trigger_tooltip = {
					tooltip = WI_map_change_state_logunit_GUI_click_enabled_tt_2
					var:china_acted_state = {
						NOT = { check_variable = { WI_officer_change_calc = 0 } }
						NOT = { has_state_flag = WI_map_change_state_logunit_cooldown }
						check_variable = {
							var = WI_old_state_officer_confirmed
							value = YUN.YUN_WI_logunit
							compare = less_than_or_equals
						}
					}
				}
			}
		}
#
		properties = {
			WI_map_state_officers_GUI = {
				frame = china_acted_state:YUN_state_officer_percentage
			}
		}
	}

	TNO_YUN_WI_states_action_mil_GUI = {
		context_type = player_context
		parent_window_token = "TNO_YUN_WI_map"
		window_name = "TNO_YUN_WI_states_action_mil_GUI"
#
		visible = {
			check_variable = { WI_map_state_section_GUI = 2 }
			var:china_acted_state = {
				is_controlled_by = YUN
			}
			has_country_flag = WI_GUI_map_open
			OR = {
				has_global_flag = CHI_Western_Insurrection_Crisis
				has_global_flag = YUN_NPA_GAW_Crisis
			}
		}
#
		effects = {
			WI_action_mil_close_button_GUI_click = {
				clear_variable = WI_map_state_section_GUI
			}
			WI_map_increase_state_mil_level_GUI_click = {
				if = {
					limit = { check_variable = { state_mil_level_scale = 2 } }
					var:china_acted_state = {
						add_to_variable = { WI_state_mil_level = 10 }
						set_variable = { WI_state_mil_level_calc = WI_state_mil_level_true }
						add_to_variable = { WI_state_mil_level_calc = WI_state_mil_level }
					}
				}
				else = {
					var:china_acted_state = {
						add_to_variable = { WI_state_mil_level = 5 }
						set_variable = { WI_state_mil_level_calc = WI_state_mil_level_true }
						add_to_variable = { WI_state_mil_level_calc = WI_state_mil_level }
					}
				}
			}
			WI_map_decrease_state_mil_level_GUI_click = {
				if = {
					limit = { check_variable = { state_mil_level_scale = 2 } }
					var:china_acted_state = {
						add_to_variable = { WI_state_mil_level = -10 }
						set_variable = { WI_state_mil_level_calc = WI_state_mil_level_true }
						add_to_variable = { WI_state_mil_level_calc = WI_state_mil_level }
					}
				}
				else = {
					var:china_acted_state = {
						add_to_variable = { WI_state_mil_level = -5 }
						set_variable = { WI_state_mil_level_calc = WI_state_mil_level_true }
						add_to_variable = { WI_state_mil_level_calc = WI_state_mil_level }
					}
				}
				update_YUN_WI_map = yes
			}
			WI_map_state_mil_level_5x_GUI_click = {
				set_variable = { state_mil_level_scale = 1 }
			}
			WI_map_state_mil_level_10x_GUI_click = {
				set_variable = { state_mil_level_scale = 2 }
			}
			WI_map_state_mil_level_one_quarter_GUI_click = {
				var:china_acted_state = {
					set_temp_variable = { WI_state_25_percent_mil = WI_state_mil_level_true }
					subtract_from_temp_variable = { WI_state_25_percent_mil = 25 }
					multiply_temp_variable = { WI_state_25_percent_mil = -1 }
					set_variable = { WI_state_mil_level = WI_state_25_percent_mil }
					set_variable = { WI_state_mil_level_calc = WI_state_mil_level_true }
					add_to_variable = { WI_state_mil_level_calc = WI_state_mil_level }
				}
			}
			WI_map_state_mil_level_half_GUI_click = {
				var:china_acted_state = {
					set_temp_variable = { WI_state_50_percent_mil = WI_state_mil_level_true }
					subtract_from_temp_variable = { WI_state_50_percent_mil = 50 }
					multiply_temp_variable = { WI_state_50_percent_mil = -1 }
					set_variable = { WI_state_mil_level = WI_state_50_percent_mil }
					set_variable = { WI_state_mil_level_calc = WI_state_mil_level_true }
					add_to_variable = { WI_state_mil_level_calc = WI_state_mil_level }
				}
			}
			WI_map_state_mil_level_three_quarter_GUI_click = {
				var:china_acted_state = {
					set_temp_variable = { WI_state_75_percent_mil = WI_state_mil_level_true }
					subtract_from_temp_variable = { WI_state_75_percent_mil = 75 }
					multiply_temp_variable = { WI_state_75_percent_mil = -1 }
					set_variable = { WI_state_mil_level = WI_state_75_percent_mil }
					set_variable = { WI_state_mil_level_calc = WI_state_mil_level_true }
					add_to_variable = { WI_state_mil_level_calc = WI_state_mil_level }
				}
			}
			WI_map_state_mil_level_full_GUI_click = {
				var:china_acted_state = {
					set_temp_variable = { WI_state_100_percent_mil = WI_state_mil_level_true }
					subtract_from_temp_variable = { WI_state_100_percent_mil = 100 }
					multiply_temp_variable = { WI_state_100_percent_mil = -1 }
					set_variable = { WI_state_mil_level = WI_state_100_percent_mil }
					set_variable = { WI_state_mil_level_calc = WI_state_mil_level_true }
					add_to_variable = { WI_state_mil_level_calc = WI_state_mil_level }
				}
			}
			WI_map_change_state_mil_level_GUI_click = {
				add_political_power = -10
				var:china_acted_state = {
					YUN_WI_state_mil_level_speed = yes
					set_state_flag = {
						flag = WI_map_change_state_mil_level_cooldown
						days = 30
						value = 1
					}
					clear_variable = WI_state_mil_level
				}
				update_YUN_WI_map = yes
			}
		}
#
		triggers = {
			WI_map_change_state_mil_level_GUI_click_enabled = {
				has_political_power > 10
				custom_trigger_tooltip = {
					tooltip = WI_map_change_state_mil_level_GUI_click_enabled_tt
					var:china_acted_state = {
						NOT = { has_state_flag = WI_map_change_state_mil_level_cooldown }
						NOT = { check_variable = { WI_state_mil_level = 0 } }
					}
				}
			}
			WI_map_state_mil_level_5x_GUI_click_enabled = {
				check_variable = { state_mil_level_scale = 2 }
			}
			WI_map_state_mil_level_10x_GUI_click_enabled = {
				check_variable = { state_mil_level_scale = 1 }
			}
			WI_map_increase_state_mil_level_GUI_click_enabled = {
				var:china_acted_state = {
					check_variable = { WI_state_mil_level_calc < 100 }
				}
			}
			WI_map_decrease_state_mil_level_GUI_click_enabled = {
				var:china_acted_state = {
					check_variable = { WI_state_mil_level_calc > 0 }
				}
			}
		}
#
		properties = {
			WI_map_state_mil_level_bar_GUI = {
				frame = china_acted_state:WI_state_mil_level_confirmed
			}
		}
	}

	TNO_YUN_WI_states_action_adm = {
		context_type = selected_state_context
		parent_window_token = selected_state_view
		parent_window_name = "TNO_YUN_WI_state_action_section"
		window_name = "TNO_YUN_WI_states_action_adm"
##
		visible = {
			YUN = { check_variable = { WI_map_state_section = 1 } }
			THIS = {
				is_controlled_by = YUN
				NOT = { state = 325 }
				NOT = { state = 960 }
				NOT = { state = 603 }
				if = {
					limit = { has_global_flag = WI_NPA_takes_Sichuan }
					NOT = { state = 605 }
					NOT = { state = 1537 }
					NOT = { state = 1538 }
				}
			}
		}
##
		effects = {
			WI_action_adm_close_button_click = {
				clear_variable = YUN.WI_map_state_section
			}
			WI_map_update_state_info_click = {
				THIS = {
					#YUN_conquered_state_calc = yes
					YUN_update_state_officers_effects = yes
				}
			}
			WI_map_change_state_logunit_click = {
				THIS = {
					set_state_flag = {
						flag = WI_map_change_state_logunit_cooldown
						days = 30
						value = 1
					}
					set_variable = { WI_current_state_officer = YUN_WI_state_logunit_change_confirmed }
					clear_variable = YUN_WI_state_logunit_percent
					clear_variable = WI_officer_change_calc
					YUN_update_state_officers_effects = yes
					add_to_variable = { YUN.WI_officers_taken_total = WI_old_state_officer_confirmed }
					subtract_from_variable = { YUN.YUN_WI_logunit = WI_old_state_officer_confirmed }
				}
				YUN = { add_political_power = -10 }
				update_YUN_WI_map = yes
			}
			WI_map_increase_state_logunit_percent_click = {
				if = {
					limit = { check_variable = { YUN.state_admin_level_scale = 2 } }
					THIS = {
						add_to_variable = { YUN_WI_state_logunit_percent = 10 }
						WI_map_state_logunit_calc = yes
					}
				}
				else = {
					THIS = {
						add_to_variable = { YUN_WI_state_logunit_percent = 5 }
						WI_map_state_logunit_calc = yes
					}
				}
			}
			WI_map_decrease_state_logunit_percent_click = {
				if = {
					limit = { check_variable = { YUN.state_admin_level_scale = 2 } }
					THIS = {
						add_to_variable = { YUN_WI_state_logunit_percent = -10 }
						WI_map_state_logunit_calc = yes
					}
				}
				else = {
					THIS = {
						add_to_variable = { YUN_WI_state_logunit_percent = -5 }
						WI_map_state_logunit_calc = yes
					}
				}
			}
			WI_map_state_admin_level_5x_click = {
				set_variable = { YUN.state_admin_level_scale = 1 }
			}
			WI_map_state_admin_level_10x_click = {
				set_variable = { YUN.state_admin_level_scale = 2 }
			}
			WI_map_state_admin_level_one_quarter_click = {
				THIS = {
					set_temp_variable = { WI_state_25_percent_adm = YUN_state_officer_percentage }
					subtract_from_temp_variable = { WI_state_25_percent_adm = 25 }
					multiply_temp_variable = { WI_state_25_percent_adm = -1 }
					set_variable = { YUN_WI_state_logunit_percent = WI_state_25_percent_adm }
					WI_map_state_logunit_calc = yes
				}
			}
			WI_map_state_admin_level_half_click = {
				THIS = {
					set_temp_variable = { WI_state_50_percent_adm = YUN_state_officer_percentage }
					subtract_from_temp_variable = { WI_state_50_percent_adm = 50 }
					multiply_temp_variable = { WI_state_50_percent_adm = -1 }
					set_variable = { YUN_WI_state_logunit_percent = WI_state_50_percent_adm }
					WI_map_state_logunit_calc = yes
				}
			}
			WI_map_state_admin_level_three_quarter_click = {
				THIS = {
					set_temp_variable = { WI_state_75_percent_adm = YUN_state_officer_percentage }
					subtract_from_temp_variable = { WI_state_75_percent_adm = 75 }
					multiply_temp_variable = { WI_state_75_percent_adm = -1 }
					set_variable = { YUN_WI_state_logunit_percent = WI_state_75_percent_adm }
					WI_map_state_logunit_calc = yes
				}
			}
			WI_map_state_admin_level_full_click = {
				THIS = {
					set_temp_variable = { WI_state_100_percent_adm = YUN_state_officer_percentage }
					subtract_from_temp_variable = { WI_state_100_percent_adm = 100 }
					multiply_temp_variable = { WI_state_100_percent_adm = -1 }
					set_variable = { YUN_WI_state_logunit_percent = WI_state_100_percent_adm }
					WI_map_state_logunit_calc = yes
				}
			}
		}
##
		triggers = {
			WI_map_increase_state_logunit_percent_click_enabled = {
				check_variable = { YUN_officier_percent_calc < 100 }
			}
			WI_map_decrease_state_logunit_percent_click_enabled = {
				check_variable = { YUN_officier_percent_calc > 0 }
			}
			WI_map_state_admin_level_5x_click_enabled = {
				check_variable = { YUN.state_admin_level_scale = 2 }
			}
			WI_map_state_admin_level_10x_click_enabled = {
				check_variable = { YUN.state_admin_level_scale = 1 }
			}
			WI_map_change_state_logunit_click_enabled = {
				YUN = { has_political_power > 10 }
				custom_trigger_tooltip = {
					tooltip = WI_map_change_state_logunit_click_enabled_tt_1
					THIS = {
						NOT = { has_state_flag = WI_map_change_state_logunit_cooldown }
					}
				}
				custom_trigger_tooltip = {
					tooltip = WI_map_change_state_logunit_click_enabled_tt_2
					THIS = {
						NOT = { check_variable = { WI_officer_change_calc = 0 } }
						NOT = { has_state_flag = WI_map_change_state_logunit_cooldown }
						check_variable = {
							var = WI_old_state_officer_confirmed
							value = YUN.YUN_WI_logunit
							compare = less_than_or_equals
						}
					}
				}
			}
		}
##
		properties = {
			WI_map_state_officers = {
				frame = THIS.YUN_state_officer_percentage
			}
			WI_map_state_integration_progress = {
				frame = THIS.WI_state_integrate_progress
			}
		}
	}
#
	TNO_YUN_WI_states_action_mil = {
		context_type = selected_state_context
		parent_window_token = selected_state_view
		parent_window_name = "TNO_YUN_WI_state_action_section"
		window_name = "TNO_YUN_WI_states_action_mil"
#
		visible = {
			YUN = { check_variable = { WI_map_state_section = 2 } }
			THIS = { is_controlled_by = YUN }
		}
#
		dynamic_lists = {
			WI_greater_china_states_action = {
				array = YUN.china_states_action
				entry_container = WI_china_states_action
				value = china_states_action_id
			}
		}
#
		effects = {
			WI_action_mil_close_button_click = {
				clear_variable = YUN.WI_map_state_section
			}
			WI_map_china_states_action_click = {
				YUN_WI_china_states_action_starts = yes
			}
			WI_map_increase_state_mil_level_click = {
				if = {
					limit = { check_variable = { YUN.state_mil_level_scale = 2 } }
					THIS = {
						add_to_variable = { WI_state_mil_level = 10 }
						set_variable = { WI_state_mil_level_calc = WI_state_mil_level_true }
						add_to_variable = { WI_state_mil_level_calc = WI_state_mil_level }
					}
				}
				else = {
					THIS = {
						add_to_variable = { WI_state_mil_level = 5 }
						set_variable = { WI_state_mil_level_calc = WI_state_mil_level_true }
						add_to_variable = { WI_state_mil_level_calc = WI_state_mil_level }
					}
				}
			}
			WI_map_decrease_state_mil_level_click = {
				if = {
					limit = { check_variable = { YUN.state_mil_level_scale = 2 } }
					THIS = {
						add_to_variable = { WI_state_mil_level = -10 }
						set_variable = { WI_state_mil_level_calc = WI_state_mil_level_true }
						add_to_variable = { WI_state_mil_level_calc = WI_state_mil_level }
					}
				}
				else = {
					THIS = {
						add_to_variable = { WI_state_mil_level = -5 }
						set_variable = { WI_state_mil_level_calc = WI_state_mil_level_true }
						add_to_variable = { WI_state_mil_level_calc = WI_state_mil_level }
					}
				}
				update_YUN_WI_map = yes
			}
			WI_map_state_mil_level_5x_click = {
				set_variable = { YUN.state_mil_level_scale = 1 }
			}
			WI_map_state_mil_level_10x_click = {
				set_variable = { YUN.state_mil_level_scale = 2 }
			}
			WI_map_state_mil_level_one_quarter_click = {
				THIS = {
					set_temp_variable = { WI_state_25_percent_mil = WI_state_mil_level_true }
					subtract_from_temp_variable = { WI_state_25_percent_mil = 25 }
					multiply_temp_variable = { WI_state_25_percent_mil = -1 }
					set_variable = { WI_state_mil_level = WI_state_25_percent_mil }
					set_variable = { WI_state_mil_level_calc = WI_state_mil_level_true }
					add_to_variable = { WI_state_mil_level_calc = WI_state_mil_level }
				}
			}
			WI_map_state_mil_level_half_click = {
				THIS = {
					set_temp_variable = { WI_state_50_percent_mil = WI_state_mil_level_true }
					subtract_from_temp_variable = { WI_state_50_percent_mil = 50 }
					multiply_temp_variable = { WI_state_50_percent_mil = -1 }
					set_variable = { WI_state_mil_level = WI_state_50_percent_mil }
					set_variable = { WI_state_mil_level_calc = WI_state_mil_level_true }
					add_to_variable = { WI_state_mil_level_calc = WI_state_mil_level }
				}
			}
			WI_map_state_mil_level_three_quarter_click = {
				THIS = {
					set_temp_variable = { WI_state_75_percent_mil = WI_state_mil_level_true }
					subtract_from_temp_variable = { WI_state_75_percent_mil = 75 }
					multiply_temp_variable = { WI_state_75_percent_mil = -1 }
					set_variable = { WI_state_mil_level = WI_state_75_percent_mil }
					set_variable = { WI_state_mil_level_calc = WI_state_mil_level_true }
					add_to_variable = { WI_state_mil_level_calc = WI_state_mil_level }
				}
			}
			WI_map_state_mil_level_full_click = {
				THIS = {
					set_temp_variable = { WI_state_100_percent_mil = WI_state_mil_level_true }
					subtract_from_temp_variable = { WI_state_100_percent_mil = 100 }
					multiply_temp_variable = { WI_state_100_percent_mil = -1 }
					set_variable = { WI_state_mil_level = WI_state_100_percent_mil }
					set_variable = { WI_state_mil_level_calc = WI_state_mil_level_true }
					add_to_variable = { WI_state_mil_level_calc = WI_state_mil_level }
				}
			}
			WI_map_change_state_mil_level_click = {
				THIS = {
					YUN_WI_state_mil_level_speed = yes
					set_state_flag = {
						flag = WI_map_change_state_mil_level_cooldown
						days = 30
						value = 1
					}
					clear_variable = WI_state_mil_level
				}
				YUN = { add_political_power = -10 }
				update_YUN_WI_map = yes
			}
		}
#
		triggers = {
			WI_map_change_state_mil_level_click_enabled = {
				custom_trigger_tooltip = {
					tooltip = WI_map_change_state_mil_level_click_enabled_tt
					THIS = {
						NOT = { has_state_flag = WI_map_change_state_mil_level_cooldown }
						NOT = { check_variable = { WI_state_mil_level = 0 } }
					}
				}
				YUN = { has_political_power > 10 }
			}
			WI_map_china_states_action_click_enabled = {
				YUN_WI_map_enable_action = yes
			}
			WI_map_state_mil_level_5x_click_enabled = {
				check_variable = { YUN.state_mil_level_scale = 2 }
			}
			WI_map_state_mil_level_10x_click_enabled = {
				check_variable = { YUN.state_mil_level_scale = 1 }
			}
			WI_map_increase_state_mil_level_click_enabled = {
				check_variable = { WI_state_mil_level_calc < 100 }
			}
			WI_map_decrease_state_mil_level_click_enabled = {
				check_variable = { WI_state_mil_level_calc > 0 }
			}
		}

		properties = {
			WI_map_state_mil_level_bar = {
				frame = THIS.WI_state_mil_level_confirmed
			}
		}
	}

	TNO_YUN_insurgency_GUI = {
		context_type = decision_category
		window_name = "TNO_YUN_insurgency_GUI"
		dirty = YUN.YUN_insurgency_dirty
		visible = {
			tag = YUN
		}
		effects = {
			Xinan_GUI_garrison_size_change_click = {
				add_to_variable = { YUN_garrison_size_confirmed = YUN_Xinan_Insurgency_garrison_size }
				clamp_variable = {
					var = YUN_garrison_size_confirmed
					min = 0
				}
				clear_variable = YUN_Xinan_Insurgency_garrison_size
				clear_variable = YUN_garrion_cost_calc
				set_country_flag = {
					flag = YUN_garrison_change_cooldown
					days = 30
					value = 1
				}
				YUN_Update_Insurgency_tick = yes
			}
			Xinan_GUI_garrison_size_increase_click = {
				add_to_variable = { YUN_Xinan_Insurgency_garrison_size = 1 }
				add_to_variable = { YUN.YUN_insurgency_dirty = 1 }
				set_variable = { YUN_garrion_cost_calc = YUN_Xinan_Insurgency_garrison_size }
				multiply_variable = { YUN_garrion_cost_calc = 0.125 } #It's just works, I don't know why doing it in one breaks it, but it does
				multiply_variable = { YUN_garrion_cost_calc = 0.1 }
			}
			Xinan_GUI_garrison_size_decrease_click = {
				subtract_from_variable = { YUN_Xinan_Insurgency_garrison_size = 1 }
				add_to_variable = { YUN.YUN_insurgency_dirty = 1 }
				set_variable = { YUN_garrion_cost_calc = YUN_Xinan_Insurgency_garrison_size }
				multiply_variable = { YUN_garrion_cost_calc = 0.125 }
				multiply_variable = { YUN_garrion_cost_calc = 0.1 }
			}
			Xinan_GUI_police_size_change_click = {
				add_to_variable = { YUN_police_size_confirmed = YUN_Xinan_Insurgency_police_size }
				clamp_variable = {
					var = YUN_police_size_confirmed
					min = 0
				}
				clear_variable = YUN_Xinan_Insurgency_police_size
				clear_variable = YUN_police_cost_calc
				set_country_flag = {
					flag = YUN_police_change_cooldown
					days = 30
					value = 1
				}
				YUN_Update_Insurgency_tick = yes
			}
			Xinan_GUI_police_size_increase_click = {
				add_to_variable = { YUN_Xinan_Insurgency_police_size = 1 }
				add_to_variable = { YUN.YUN_insurgency_dirty = 1 }
				set_variable = { YUN_police_cost_calc = YUN_Xinan_Insurgency_police_size }
				multiply_variable = { YUN_police_cost_calc = 0.01 }
			}
			Xinan_GUI_police_size_decrease_click = {
				subtract_from_variable = { YUN_Xinan_Insurgency_police_size = 1 }
				add_to_variable = { YUN.YUN_insurgency_dirty = 1 }
				set_variable = { YUN_police_cost_calc = YUN_Xinan_Insurgency_police_size }
				multiply_variable = { YUN_police_cost_calc = 0.01 }
			}
		}
		triggers = {
			Xinan_GUI_garrison_size_change_click_enabled = {
				custom_trigger_tooltip = {
					tooltip = Xinan_GUI_garrison_size_change_click_enabled_tt
					NOT = { has_country_flag = YUN_garrison_change_cooldown }
				}
				set_temp_variable = { YUN_Xinan_Insurgency_garrison_size_estimated = YUN_garrison_size_confirmed }
				add_to_temp_variable = { YUN_Xinan_Insurgency_garrison_size_estimated = YUN_Xinan_Insurgency_garrison_size }
				NOT = { check_variable = { YUN_Xinan_Insurgency_garrison_size_estimated < 0 } }
				NOT = { check_variable = { YUN_Xinan_Insurgency_garrison_size = 0 } }
			}
			Xinan_GUI_police_size_change_click_enabled = {
				custom_trigger_tooltip = {
					tooltip = Xinan_GUI_police_size_change_click_enabled_tt
					NOT = { has_country_flag = YUN_police_change_cooldown }
				}
				set_temp_variable = { YUN_Xinan_Insurgency_police_size_estimated = YUN_police_size_confirmed }
				add_to_temp_variable = { YUN_Xinan_Insurgency_police_size_estimated = YUN_Xinan_Insurgency_police_size }
				NOT = { check_variable = { YUN_Xinan_Insurgency_police_size_estimated < 0 } }
				NOT = { check_variable = { YUN_Xinan_Insurgency_police_size = 0 } }
			}
		}
		properties = {
			GFX_YUN_Xinan_GUI_NRA_info = {
				frame = YunNRA_Power
			}
			GFX_YUN_Xinan_GUI_CCP_info = {
				frame = YunCCP_Power
			}
			GFX_YUN_Xinan_GUI_Bandit_info = {
				frame = YunBandit_Power
			}
			GFX_YUN_Xinan_GUI_NPA_info = {
				frame = YunNPA_Power
			}
		}
	}

	TNO_YUN_WI_Sichuan_GUI = {
		context_type = decision_category
		window_name = "TNO_YUN_WI_Sichuan_GUI"
		dirty = global.YUN_WI_Sichuan_dirty
		visible = {
			OR = {
				original_tag = YUN
				original_tag = CHI
			}
		}
		effects = {
			YUN_WI_Sichuan_GUI_decrease_pp_click = {
				add_to_variable = { WI_Sichuan_invest_pp = -5 }
				add_to_variable = { global.YUN_WI_Sichuan_dirty = 1 }
			}
			YUN_WI_Sichuan_GUI_decrease_pp_shift_click = {
				add_to_variable = { WI_Sichuan_invest_pp = -50 }
				add_to_variable = { global.YUN_WI_Sichuan_dirty = 1 }
				clamp_variable = { var = WI_Sichuan_invest_pp min = 0 }
			}
			YUN_WI_Sichuan_GUI_increase_pp_click = {
				add_to_variable = { WI_Sichuan_invest_pp = 5 }
				add_to_variable = { global.YUN_WI_Sichuan_dirty = 1 }
			}
			YUN_WI_Sichuan_GUI_increase_pp_shift_click = {
				add_to_variable = { WI_Sichuan_invest_pp = 50 }
				add_to_variable = { global.YUN_WI_Sichuan_dirty = 1 }
				clamp_variable = { var = WI_Sichuan_invest_pp max = 50 }
			}
			YUN_WI_Sichuan_GUI_decrease_weapon_click = {
				add_to_variable = { WI_Sichuan_invest_weapon = -50 }
				add_to_variable = { global.YUN_WI_Sichuan_dirty = 1 }
			}
			YUN_WI_Sichuan_GUI_decrease_weapon_shift_click = {
				add_to_variable = { WI_Sichuan_invest_weapon = -500 }
				add_to_variable = { global.YUN_WI_Sichuan_dirty = 1 }
				clamp_variable = { var = WI_Sichuan_invest_weapon min = 0 }
			}
			YUN_WI_Sichuan_GUI_increase_weapon_click = {
				add_to_variable = { WI_Sichuan_invest_weapon = 50 }
				add_to_variable = { global.YUN_WI_Sichuan_dirty = 1 }
			}
			YUN_WI_Sichuan_GUI_increase_weapon_shift_click = {
				add_to_variable = { WI_Sichuan_invest_weapon = 500 }
				add_to_variable = { global.YUN_WI_Sichuan_dirty = 1 }
				clamp_variable = { var = WI_Sichuan_invest_weapon max = 500 }
			}
			YUN_WI_Sichuan_GUI_invest_click = {
				WI_Sichuan_invest_calc = yes
			}
		}
		triggers = {
			YUN_WI_Sichuan_GUI_invest_click_enabled = {
				custom_trigger_tooltip = {
					tooltip = YUN_WI_Sichuan_GUI_invest_click_enabled_tt
					set_temp_variable = { WI_Sichuan_invest_pp_confirmed = WI_Sichuan_invest_pp }
					subtract_from_temp_variable = { WI_Sichuan_invest_pp_confirmed = 0.01 }
					OR = {
						AND = {
							check_variable = { WI_Sichuan_invest_pp > 0 }
							has_political_power > WI_Sichuan_invest_pp_confirmed
							if = {
								limit = { check_variable = { WI_Sichuan_invest_weapon > 0 } }
								Sichuan_help_ai = yes
							}
						}
						AND = {
							check_variable = { WI_Sichuan_invest_weapon > 0 }
							Sichuan_help_ai = yes
							if = {
								limit = { check_variable = { WI_Sichuan_invest_pp > 0 } }
								has_political_power > WI_Sichuan_invest_pp_confirmed
							}
						}
					}
				}
				NOT = { has_country_flag = WI_Sichuan_support_cooldown }
			}
			YUN_WI_Sichuan_GUI_decrease_pp_click_enabled = {
				NOT = { check_variable = { WI_Sichuan_invest_pp = 0 } }
			}
			YUN_WI_Sichuan_GUI_increase_pp_click_enabled = {
				NOT = { check_variable = { WI_Sichuan_invest_pp = 50 } }
			}
			YUN_WI_Sichuan_GUI_decrease_weapon_click_enabled = {
				NOT = { check_variable = { WI_Sichuan_invest_weapon = 0 } }
			}
			YUN_WI_Sichuan_GUI_increase_weapon_click_enabled = {
				NOT = { check_variable = { WI_Sichuan_invest_weapon = 500 } }
			}
		}
		properties = {
			YUN_WI_Sichuan_influence = {
				frame = GUI_SIC_Influence
			}
		}
	}
}